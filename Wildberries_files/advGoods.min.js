(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";function asyncGeneratorStep(t,n,e,r,s,a,i){try{var o=t[a](i),c=o.value}catch(t){return void e(t)}o.done?n(c):Promise.resolve(c).then(r,s)}function _asyncToGenerator(t){return function(){var n=this,e=arguments;return new Promise(function(r,s){var a=t.apply(n,e);function i(t){asyncGeneratorStep(a,r,s,i,o,"next",t)}function o(t){asyncGeneratorStep(a,r,s,i,o,"throw",t)}i(void 0)})}}!function(){var t=function(){function t(t,n,e,r){this.advGoods=t,this.queryDictionary=n,this.container=e,this.queryHelper=r,this.unshownCards=[],this.advTypeIsSearch=void 0!==n.searchtext,this._doOnEvent=this._doOnEvent.bind(this)}var n=t.prototype;return n.setAdvInfoOnCards=function(){var t=this;if(this._removeShowStatEvents(),Array.isArray(this.advGoods)&&0!==this.advGoods.length){var n=this.container.querySelectorAll(".j-card-item"),e=[];n.forEach(function(n){var r=t.advGoods.find(function(t){return t.nmId==n.dataset.popupNmId});r&&(n.dataset.advStatFields=r.statisticFieldsJson,n.dataset.extraAnaliticsCode=t.queryDictionary.menuId>0?"CAB":"SAB",e.push(n))}),this._bindShownStatistic(e),this._bindClickStatistic(e)}},n.getAdvGoodsAsync=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(n){var e,r,s,a,i,o,c,u,d,h,p,v=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.advTypeIsSearch){t.next=14;break}return t.next=3,this._extractParametersForSearch(n,this.queryHelper.getFiltersQuery(new URLSearchParams));case 3:return s=t.sent,a=s.queryModel,i=s.brands,o=s.xInfo,c={method:"POST",body:JSON.stringify({brands:i})},t.next=10,fetch("https://catalog-ads.wildberries.ru/api/v4/search?".concat(a.toString(),"&").concat(o),c).then(function(t){return t.json()});case 10:(u=t.sent)&&(d=[],h=null==u?void 0:u.map(function(t){var n,e;t.priceU=t.price,t.salePriceU=t.salePrice,t.feedbacks=t.feedbackCount,t.pics=t.picsCount;var r=wb.xnm.convertXProductToSpaCatalogProduct(t);r.isAdv=!0;var s={nmId:r.nmId,position:t.position,statisticFieldsJson:JSON.stringify({advertId:t.advertId,position:t.position,cpm:t.cpm,subjectId:r.subjectId,brandId:t.brandId,kindId:null!==(n=null===(e=t.kindIds)||void 0===e?void 0:e[0])&&void 0!==n?n:0})};return d.push(s),r}),r={products:h,advertCardsInfo:d}),t.next=19;break;case 14:return p=this.queryHelper.getFiltersQuery(),Object.keys(this.queryDictionary).forEach(function(t){return p.append(t,v.queryDictionary[t])}),t.next=18,this.$httpClient.fetchJSON("/spa/catalog/advGoods?".concat(p.toString()));case 18:r=t.sent;case 19:return this.advGoods=null===(e=r)||void 0===e?void 0:e.advertCardsInfo,t.abrupt("return",r);case 21:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}(),n.updateModel=function(t,n){this.advGoods=t,this.queryDictionary=n,this.setAdvInfoOnCards()},n.reset=function(){this.advGoods=[],this.unshownCards=[],this._removeShowStatEvents()},n._extractParametersForSearch=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(n,e){var r,s,a,i,o,c,u,d,h,p,v;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._getFilters(n);case 2:return o=t.sent,c=o.filters,u=o.xInfo,d=null==c?void 0:null===(r=c.find(function(t){return"xsubject"===t.key}))||void 0===r?void 0:r.items,h=null==c?void 0:null===(s=c.find(function(t){return"fkind"===t.key}))||void 0===s?void 0:s.items,p=null==c?void 0:null===(a=c.find(function(t){return"fcolor"===t.key}))||void 0===a?void 0:a.items,!e.has("xsubject")&&d&&Object.keys(d).length>0&&e.set("ssubject",d.sort(function(t,n){return n.count-t.count}).slice(0,5).map(function(t){return t.id}).join(",")),!e.has("fkind")&&h&&Object.keys(h).length>0&&e.set("skind",h.map(function(t){return t.id}).join(",")),!e.has("fcolor")&&p&&Object.keys(p).length>0&&e.set("scolor",p.map(function(t){return t.id}).join(",")),v=null==c?void 0:null===(i=c.find(function(t){return"fbrand"===t.key}))||void 0===i?void 0:i.items.map(function(t){return t.id}),e.set("search",n.search),t.abrupt("return",{queryModel:e,brands:v,xInfo:u});case 12:case"end":return t.stop()}},t,this)}));return function(n,e){return t.apply(this,arguments)}}(),n._getFilters=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(n){var e,r,s,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$getCurrentXInfoAsync();case 2:return r=t.sent,s="".concat(this._getXpath(n),"/filters?filters=xsubject;fkind;fcolor;fbrand&").concat(r),n.xcatalogQuery&&(s+="&"+n.xcatalogQuery),t.next=7,fetch(s).then(function(t){return t.json()});case 7:return a=t.sent,t.abrupt("return",{filters:null===(e=a.data)||void 0===e?void 0:e.filters,xInfo:r});case 9:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}(),n._getXpath=function(t){return t.isValid?"".concat("ru"===wb.settings.currentLocale?"https://wbxcatalog-ru.wildberries.ru/":"https://wbxcatalog-sng.wildberries.ru/").concat(t.xcatalogShard):"/search/extsearch"},n._bindShownStatistic=function(t){if((null==t?void 0:t.length)>0){var n=this._getCardsByShownType(t),e=n.shown,r=n.unshown;this._sendShownStatistic(e),r.length>0&&(this.unshownCards=r,this._bindShowStatEvents())}},n._bindClickStatistic=function(t){var n=this;t.forEach(function(t){var e=n.$helper.delegator(".j-open-product-popup, .j-open-full-product-card, .j-slider-item, .j-size, .j-add-to-basket, .j-add-to-postpone",function(){n._sendClickStatistic(t),t.removeEventListener("click",e)});t.addEventListener("click",e)})},n._sendShownStatistic=function(t){var n=this;t.forEach(function(t){if(t.dataset.shownStatisticSend=!0,0!=t.clientWidth){var e=n._tryGetStatParams(t);null!=e&&wb.stat.sendEvent(n.advTypeIsSearch?"AFDS":"ACTLS",e,!1)}})},n._tryGetStatParams=function(t){var n=t.dataset.advStatFields,e=t.dataset.popupNmId;if(null==n)return null;try{var r=JSON.parse(n);return this._createStatParams(e,r)}catch(t){return console.error(t),null}},n._createStatParams=function(t,n){var e=[];return this.advTypeIsSearch?(e.push(this.$stat.wrapParam("PARAM1",this.queryDictionary.searchtext)),e.push(this.$stat.wrapParam("PARAM2",n.advertId)),e.push(this.$stat.wrapParam("PARAM3",t)),e.push(this.$stat.wrapParam("PARAM4",n.position)),e.push(this.$stat.wrapParam("PARAM5",n.cpm))):(e.push(this.$stat.wrapParam("MId",this.queryDictionary.menuId)),e.push(this.$stat.wrapParam("ADID",n.advertId)),e.push(this.$stat.wrapParam("NMID",t)),e.push(this.$stat.wrapParam("POS",n.position)),e.push(this.$stat.wrapParam("CPM",n.cpm)),e.push(this.$stat.wrapParam("SID",n.subjectId)),e.push(this.$stat.wrapParam("BRID",n.brandId)),e.push(this.$stat.wrapParam("KID",n.kindId))),e},n._bindShowStatEvents=function(){document.addEventListener("scroll",this._doOnEvent,{passive:!0}),window.addEventListener("resize",this._doOnEvent,{passive:!0})},n._removeShowStatEvents=function(){document.removeEventListener("scroll",this._doOnEvent,{passive:!0}),window.removeEventListener("resize",this._doOnEvent,{passive:!0})},n._getCardsByShownType=function(t){return t.reduce(function(t,n){return n.dataset.shownStatisticSend?t:(wb.utils.isElementInViewport(n)?t.shown.push(n):t.unshown.push(n),t)},{shown:[],unshown:[]})},n._doOnEvent=function(){var t=this._getCardsByShownType(this.unshownCards),n=t.shown,e=t.unshown;this._sendShownStatistic(n),0==e.length&&this._removeShowStatEvents()},n._sendClickStatistic=function(t){var n=this._tryGetStatParams(t);null!=n&&this.$stat.sendEvent(this.advTypeIsSearch?"AFDC":"ACTLC",n,!0)},t}();window.__spaModuleManager__.register("advGoods",t)}();

},{}]},{},[1]);
